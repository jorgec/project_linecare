{% load static %}

<script type="text/javascript">
    $(document).ready(function () {
        $(".endTime").bootstrapMaterialDatePicker({
            date: false,
            format: "h:mm a",
            shortTime: true,
        });
        $(".startTime").bootstrapMaterialDatePicker({
            date: false,
            format: "h:mm a",
            shortTime: true,
        }).on('change', function(e, time){
            $(".endTime").bootstrapMaterialDatePicker('setMinDate', time)
        });


        $(".endDate").bootstrapMaterialDatePicker({
            format: "YYYY-MM-DD",
            time: false
        });
        $(".startDate").bootstrapMaterialDatePicker({
            format: "YYYY-MM-DD",
            time: false
        }).on('change', function(e, date){
            $(".endDate").bootstrapMaterialDatePicker('setMinDate', date)
        });

        var countRegularScheduleForms = 0;

        $("#btnAddRegularSchedule").on('click', function (e) {
            e.preventDefault();
            countRegularScheduleForms = countRegularScheduleForms + 1;
            $("#frmAddRegularWeeklySchedule_0").clone().attr("id", "frmAddRegularWeeklySchedule_" + countRegularScheduleForms).appendTo($("#divAddRegularSchedule"));

            $(".endTime").bootstrapMaterialDatePicker({
                date: false,
                format: "h:mm a",
                shortTime: true,
            });
            $(".startTime").bootstrapMaterialDatePicker({
                date: false,
                format: "h:mm a",
                shortTime: true,
            }).on('change', function(e, time){
                $(".endTime").bootstrapMaterialDatePicker('setMinDate', time)
            });


            $(".endDate").bootstrapMaterialDatePicker({
                format: "YYYY-MM-DD",
                time: false
            });
            $(".startDate").bootstrapMaterialDatePicker({
                format: "YYYY-MM-DD",
                time: false
            }).on('change', function(e, date){
                $(".endDate").bootstrapMaterialDatePicker('setMinDate', date)
            });


        });

        $("#frmCollectionRegularWeeklySchedule").on('submit', '.frmAddRegularWeeklySchedule', function (e) {
            e.preventDefault();

            var days = $("input[name=weekday]:checked", this).map(
                function () {
                    return this.value;
                }
            ).get().join(";");
            var startTime = $("#startTime", this).val();
            var endTime = $("#endTime", this).val();
            var startDate = $("#startDate", this).val();
            var endDate = $("#endDate", this).val();
            var url = "{% url 'api_private_doctor_schedule_create' %}?medical_institution={{ rel.medical_institution.id }}";
            var formData = {
                csrfmiddlewaretoken: '{{ csrf_token }}',
                days: days,
                start_time: startTime,
                end_time: endTime,
                start_date: startDate,
                end_date: endDate,
            };
            console.log(formData);

            $.post(url, formData)
                .done(function(result){
                    $.notify({
                        message: "Schedule created!"
                    }, {
                        type: 'success'
                    });
                    updateState(model.all_schedules);
                })
                .fail(function(jqXHR, textStatus, errorThrown) {
                    $.notify({
                        message: jqXHR.responseJSON
                    }, {
                        type: 'danger'
                    });
                });
        });
    });


    model.all_schedules = {
        dataSrc: "{% url 'api_public_doctor_schedule_list' %}?id={{ rel.doctor.id }}&medical_institution={{ rel.medical_institution.id }}",
        fetch: function () {
            genericFetch('all_schedules')
        },
        onReady: true,
        onSuccessResult: [],
        onSuccess: [],
        container: $("#my_schedules_container"),
        template: $("#my_schedules_template"),
        actions: {}
    }



</script>