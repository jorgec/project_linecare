{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Linecare &mdash; Doctor Profile &mdash; {{ page_title }}</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz"
        crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'neo/css/styles.min.css' %}">

    {% block header_css %} {% endblock %}
    {% block header_js %} {% endblock %}
    <script src="{% static 'channels/js/websocketbridge.js' %}" type="text/javascript"></script>

</head>

<body>

    {% include 'neo/profile/common/nav__top.html' %}
    {% include 'neo/profile/common/nav__main.html' %}
    {% block nav_submain %}
        {% include 'neo/doctor_profiles/common/nav__submain.html' %}
    {% endblock %}

    <div class="container">
        {% block content %}{% endblock %}
    </div>

    {% include 'neo/profile/common/footer.html' %}

     <div id="backToTopDiv" class="p-4">
        <a onclick="topFunction()" title="Go to top" href="javascript:void(0)" class="rounded-circle btn-primary p-2"><i class="fas fa-arrow-up fa-fw"></i></a>
    </div>

    <script src="{% static 'neo/js/main.min.js' %}"></script>
    <script src="{% static '3rd-party/jquery.popupoverlay.js' %}"></script>
    {% block scripts %}
    {% endblock %}
    {% block base_scripts %}
    {% endblock %}
    {% block home_scripts %}
    {% endblock %}

    <script src="{% static 'neo/js/snippetProfileProgress.js' %}"></script>
    <script type="text/javascript" src="{% static '3rd-party/jquery-template/jquery.loadTemplate.min.js' %}"></script>

    <script type="text/html" id="appointment-notification-template">
        <div class="row">
            <div class="col-sm-4 col-md-1">
                <img data-src="patient.photo" class="img-thumbnail img-fluid" data-alt="patient.name">
            </div>
            <div class="col-sm-8 col-md-11">
                <strong>New appointment for <span data-content="patient.name"></span> at <span data-content="medical_institution.name"></span></strong>
                <br>
                <span data-content="schedule.day_nicename"></span>, <span data-content="schedule.time_start"></span> to <span data-content="schedule.time_end"></span>
                <br>
                #<span data-content="queue_number"></span>, <span data-content="type_display"></span>
            </div>
        </div>
    </script>

    <script type="text/javascript">
        $(document).ready(function(){

            {% if request.user.doctorprofile.display_profile_progress_status %}
                var snippet_location = $("#profile-progress-snippet");
                loadProfileProgress(snippet_location);
                snippet_location.on('click', '#dismiss-profile-progress', function(e){
                    e.preventDefault();
                    snippet_location.remove();
                    $.get("{% url 'api_doctor_profile_dismiss_profile_progress_display' %}");
                });


            {% endif %}

            var webSocketBridge = new channels.WebSocketBridge();
            webSocketBridge.connect('/notifications/receptionist/appointments/');
            webSocketBridge.listen(function (event) {
                console.log(event);
                if(event.type === "notification.alert"){
                    var a = event.appointment;
                    $.notify({
                        message: "New appointment created for " + a.patient.name + " on " + a.schedule.day_nicename + " at " + a.medical_institution.name
                    }, {
                        type: 'success'
                    });
                }
            });
        });
        window.onscroll = function() {scrollFunction()};

        function scrollFunction() {
            if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
                document.getElementById("backToTopDiv").style.display = "block";
            } else {
                document.getElementById("backToTopDiv").style.display = "none";
            }
        }

        // When the user clicks on the button, scroll to the top of the document
        function topFunction() {
            document.body.scrollTop = 0;
            document.documentElement.scrollTop = 0;
        }


    </script>

</body>

</html>